<html>
<head>
<title>RPi/GPS/IMU</title>
<script src="/jquery-3.4.1.min.js"></script>
</head>
<body>
<table>
<tr><td colspan=2 align=center id="msg">Loading...</td><tr>
<tr><th align="right">Latitude:</th><td id="lat" align="right"></td><td id="epy" align="right"></td></tr>
<tr><th align="right">Longitude:</th><td id="lon" align="right"></td><td id="epx" align="right"></td></tr>
<tr><th align="right">Altitude:</th><td id="alt" align="right"></td><td id="epv" align="right"></td></tr>
<tr><th align="right">Speed:</th><td id="speed" align="right"></td><td id="eps" align="right"></td></tr>
<tr><td colspan=3 align=center><i><p id="time"></p></i></td><tr>
</table>
<script>
var refresh=10000;
var m_to_ft = 3.28084;
var ms_to_mph = 2.23694;
$(document).ready(function()
{
  setInterval(function() {
  $.ajax({
    datatype: "json",
    url: "/gps",
    success: function(data)
    {
      var obj = JSON.parse(data);
      if (typeof obj.lat !== 'undefined') {
        $('#lat').text(obj.lat);
      } else {
        $('#lat').text("--");
      }
      if (typeof obj.epy !== 'undefined') {
        $('#epy').text("+/-"+Math.round(obj.epy*m_to_ft)+"ft");
      } else {
        $('#epy').text("--");
      }
      if (typeof obj.lon !== 'undefined') {
        $('#lon').text(obj.lon);
      } else {
        $('#lon').text("--");
      }
      if (typeof obj.epx !== 'undefined') {
        $('#epx').text("+/-"+Math.round(obj.epx*m_to_ft)+"ft");
      } else {
        $('#epx').text("--");
      }
      if (typeof obj.alt !== 'undefined') {
        $('#alt').text(Math.round(obj.alt*m_to_ft));
      } else {
        $('#alt').text("--");
      }
      if (typeof obj.epv !== 'undefined') {
        $('#epv').text("+/-"+Math.round(obj.epv*m_to_ft)+"ft");
      } else {
        $('#epv').text("--");
      }
      if (typeof obj.speed !== 'undefined') {
        $('#speed').text(Math.round(obj.speed*ms_to_mph));
      } else {
        $('#speed').text("--");
      }
      if (typeof obj.eps !== 'undefined') {
        $('#eps').text("+/-"+Math.round(obj.eps*ms_to_mph)+"mph");
      } else {
        $('#eps').text("--");
      }
      $('#msg').text("");
      if (typeof obj.time !== 'undefined') {
        $('#time').text(obj.time.replace('T', ' ').split('.')[0]);
      } else {
        $('#time').text("--");
      }
    },
    error: function(xhr, status, error)
    {
      var errorMessage = xhr.status + ": " + xhr.statusText;
      $('#msg').text("ERROR: " + errorMessage);
    }
});
}, refresh);
});
</script>
</body>
</html>
